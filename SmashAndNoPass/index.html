<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smash and no Pass</title>
    <link id="stylesheet" rel="stylesheet" href="styles/styles.css">
</head>
<body>
    <div id="duel">
        <h1 id="main-title"> SMASH OR SMASH? </h1>
        <div id="duel-characters">
            <div class="chara-div">
                <img id="pic1" class="duel-chara-pic" src="">
                <button id="name1" class="duel-btn" onclick="selectCharacter('0')">NAME 1</button>
            </div>
            <span id="duel-divider">OR</span>
            <div class="chara-div">
                <img id="pic2" class="duel-chara-pic" src="">
                <button id="name2" class="duel-btn" onclick="selectCharacter('1')">NAME 2</button>
            </div>
        </div>
    </div>
    <div id="rounds">
    </div>
    </div>

</body>
<script>
    const rounds_parent = document.getElementById("rounds");

    let characters = []; // Original array of all characters
    let current_duel = []; // Characters currently choosen
    let winner_characters = []; // Characters that won a duel in the current round

    let round = 0; // Current round number
    let current_round_div

    const name1 = document.getElementById("name1")
    const name2 = document.getElementById("name2")
    const pic1 = document.getElementById("pic1")
    const pic2 = document.getElementById("pic2")

    class Character {
        constructor(name, pic) {
            this.name = name;
            this.pic = pic;
        }
    }

    /////////////////////////////////////////////

    current_round_div = startNewRound()

    addCharacter("Concorde", "assets/characters/concorde.png")
    addCharacter("Aurora", "assets/characters/aurora.png")
    addCharacter("Rosetta", "assets/characters/rosetta.png")
    addCharacter("Zambuko", "assets/characters/zambuko.png")
    addCharacter("Wolfram", "assets/characters/wolfram.png")
    addCharacter("Sequoia", "assets/characters/sequoia.png")
    addCharacter("Charger", "assets/characters/charger.png")
    addCharacter("Redwood", "assets/characters/redwood.png")

    startDuel()

    /////////////////////////////////////////////

    // Add a new character to the character list
    function addCharacter(name, pic){

        new_character = new Character(name, pic)
        characters.push(new_character)

        addPortrait(new_character, current_round_div)
    }

    // Add a small character portrait in a div
    function addPortrait(chara, parent){
        const portrait_div = document.createElement('div');
        portrait_div.classList.add("chara-portrait-small")
        portrait_div.setAttribute('chara', chara.name);

        const portrait = document.createElement('img');
        portrait.src = chara.pic;
        portrait.classList.add("small-portrait");
        portrait_div.appendChild(portrait);

        parent.appendChild(portrait_div)
    }

    // Start a round with characters, then starting a duel
    function startNewRound(){
        round++;

        const round_number = document.createElement('h1');
        round_number.innerHTML = `Round ${round}`;
        rounds_parent.appendChild(round_number)

        const round_div = document.createElement('div');
        round_div.classList.add("round-div")
        round_div.setAttribute('round', round);

        rounds_parent.appendChild(round_div)

        return round_div
    }

    // Put two characters in for duel
    function startDuel(){
        const chara1 = removeItem(characters, getRandomItem(characters))
        const chara2 = removeItem(characters, getRandomItem(characters))

        current_duel.push(chara1)
        current_duel.push(chara2)

        console.log(`Dueling ${chara1.name} with ${chara2.name}`);

        name1.innerHTML = chara1.name
        name2.innerHTML = chara2.name

        pic1.src = chara1.pic
        pic2.src = chara2.pic
    }

    // Select a character in the duel
    function selectCharacter(idx) {

        const winner = removeItem(current_duel, current_duel[idx])
        const looser = removeItem(current_duel, current_duel[0])

        winner_characters.push(winner)

        // const char = current_duel[idx]
        const winner_portrait = current_round_div.querySelector(`div[chara="${winner.name}"]`);
        const looser_portrait = current_round_div.querySelector(`div[chara="${looser.name}"]`);

        winner_portrait.classList.add("green")
        looser_portrait.classList.add("red")
        looser_portrait.firstElementChild.classList.add("gray")

        // Start a new duel
        if (characters.length == 0) {
            current_round_div = startNewRound()

            winner_characters.forEach(function(item) {
                characters.push(item)
                addPortrait(item, current_round_div)
            });

            winner_characters = []

            startDuel()
        } else {
            startDuel()
        }
    }

    // Remove item from an array, returning it
    function removeItem(arr, item) {
        const index = arr.indexOf(item);
        return index !== -1 ? arr.splice(index, 1)[0] : null;
    }

    // Get random item from an array
    function getRandomItem(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
    }

</script>
</html>
